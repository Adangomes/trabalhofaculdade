<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Head Mouse com Webcam</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
body{
    margin:0;
    background:#111827;
    overflow:hidden;
    font-family:Arial;
    color:white;
}

#cursor{
    width:25px;
    height:25px;
    background:#ff0000;
    border-radius:50%;
    position:absolute;
    pointer-events:none;
    z-index:9999;
}

#progress{
    height:6px;
    width:0;
    background:yellow;
    position:absolute;
    pointer-events:none;
    z-index:9999;
}

video{
    position:fixed;
    bottom:10px;
    right:10px;
    width:220px;
    border-radius:10px;
    border:2px solid white;
}

button{
    padding:20px;
    font-size:18px;
    margin:20px;
}
</style>
</head>
<body>

<h2 style="text-align:center;">Controle por Movimento da Cabeça</h2>

<div style="text-align:center;">
    <button onclick="iniciarCamera()">Iniciar Webcam</button>
    <button style="position:absolute;top:250px;left:300px;">Botão Teste</button>
</div>

<div id="cursor"></div>
<div id="progress"></div>

<video id="video" autoplay playsinline></video>

<script>

const video = document.getElementById('video');
const cursor = document.getElementById('cursor');
const progress = document.getElementById('progress');

let ultimoElemento = null;
let tempoInicio = null;
let camera = null;

/* ===== MEDIAPIPE ===== */

const faceMesh = new FaceMesh({
    locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
    }
});

faceMesh.setOptions({
    maxNumFaces: 1,
    refineLandmarks: true,
    minDetectionConfidence: 0.6,
    minTrackingConfidence: 0.6
});

faceMesh.onResults(results => {

    if(results.multiFaceLandmarks.length > 0){

        const face = results.multiFaceLandmarks[0];

        // Landmark do nariz
        const nose = face[1];

        const x = nose.x * window.innerWidth;
        const y = nose.y * window.innerHeight;

        cursor.style.left = x + "px";
        cursor.style.top = y + "px";

        progress.style.left = x + "px";
        progress.style.top = (y + 30) + "px";

        const elemento = document.elementFromPoint(x, y);

        if(elemento !== ultimoElemento){
            ultimoElemento = elemento;
            tempoInicio = Date.now();
            progress.style.width = "0px";
        }

        if(elemento && tempoInicio){
            let tempo = Date.now() - tempoInicio;
            progress.style.width = (tempo / 15) + "px";

            if(tempo > 2000){
                elemento.click();
                tempoInicio = null;
                progress.style.width = "0px";
            }
        }
    }
});

/* ===== FUNÇÃO PARA INICIAR WEBCAM ===== */

function iniciarCamera(){

    camera = new Camera(video, {
        onFrame: async () => {
            await faceMesh.send({image: video});
        },
        width: 640,
        height: 480
    });

    camera.start();
}

</script>

</body>
</html>
