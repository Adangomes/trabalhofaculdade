<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Face Track - Sistema Profissional</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
body{
    margin:0;
    background:#0f172a;
    overflow:hidden;
    font-family:Arial;
    color:white;
}

/* ===== TOPO ===== */
.topbar{
    width:100%;
    height:60px;
    background:#1e293b;
    display:flex;
    align-items:center;
    padding-left:20px;
    font-size:20px;
}

/* ===== TELAS ===== */
#home{
    height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
}

#workspace{
    display:none;
    height:100vh;
    width:100%;
    background:#1e293b;
    position:relative;
}


/* ===== ÁREA INTERNA ===== */
.desktop-area{
    height:calc(100vh - 60px); /* desconta altura da topbar */
    display:flex;
    flex-direction:column;
    align-items:center;      /* centraliza horizontal */
    justify-content:center;  /* centraliza vertical */
    gap:25px;                /* espaço entre cards */
}

.card{
    background:#334155;
    padding:30px;
    border-radius:10px;
    width:300px;
    margin-bottom:20px;
}

/* ===== BOTÕES ===== */
button{
    padding:15px 25px;
    font-size:18px;
    border:none;
    border-radius:8px;
    background:#3b82f6;
    color:white;
    cursor:pointer;
}

/* ===== CURSOR ===== */
#cursor{
    width:25px;
    height:25px;
    background:red;
    border-radius:50%;
    position:absolute;
    pointer-events:none;
    z-index:9999;
}

#progress{
    height:6px;
    width:0;
    background:yellow;
    position:absolute;
    pointer-events:none;
    z-index:9999;
}

/* ===== WEBCAM ===== */
video{
    position:fixed;
    bottom:10px;
    right:10px;
    width:220px;
    border-radius:10px;
    border:2px solid white;
}
</style>
</head>
<body>

<!-- TELA INICIAL -->
<div id="home">
    <h1>FACE TRACK SYSTEM</h1>
    <br>
    <button onclick="iniciarCamera()">Iniciar Webcam</button>
    <br><br>
    <button onclick="abrirWorkspace()">Entrar no Sistema</button>
</div>

<!-- ÁREA DE TRABALHO REAL -->
<div id="workspace">
    <div class="topbar">
        Sistema Corporativo - Área de Trabalho
    </div>
     

    <div class="desktop-area">
        <div class="card">
            <h3>Módulo de Cadastro</h3>
            <p>Gerenciar usuários e dados internos</p>
            <button>Entrar</button>
        </div>
        <button onclick="voltarHome()">Voltar para Tela Inicial</button>

        <div class="card">
            <h3>Relatórios</h3>
            <p>Visualizar relatórios do sistema</p>
            <button>Acessar</button>
        </div>
       
    </div>
</div>

<div id="cursor"></div>
<div id="progress"></div>

<video id="video" autoplay playsinline></video>

<script>

const video = document.getElementById('video');
const cursor = document.getElementById('cursor');
const progress = document.getElementById('progress');

let ultimoElemento = null;
let tempoInicio = null;
let camera = null;

/* ===== TROCA DE TELAS ===== */

function abrirWorkspace(){
    document.getElementById("home").style.display="none";
    document.getElementById("workspace").style.display="block";
}

function voltarHome(){
    document.getElementById("workspace").style.display="none";
    document.getElementById("home").style.display="flex";
}

/* ===== MEDIAPIPE ===== */

const faceMesh = new FaceMesh({
    locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
    }
});

faceMesh.setOptions({
    maxNumFaces: 1,
    refineLandmarks: true,
    minDetectionConfidence: 0.6,
    minTrackingConfidence: 0.6
});

faceMesh.onResults(results => {

    if(results.multiFaceLandmarks.length > 0){

        const face = results.multiFaceLandmarks[0];
        const nose = face[1];

        const x = nose.x * window.innerWidth;
        const y = nose.y * window.innerHeight;

        cursor.style.left = x + "px";
        cursor.style.top = y + "px";

        progress.style.left = x + "px";
        progress.style.top = (y + 30) + "px";

        const elemento = document.elementFromPoint(x, y);

        if(elemento !== ultimoElemento){
            ultimoElemento = elemento;
            tempoInicio = Date.now();
            progress.style.width = "0px";
        }

        if(elemento && tempoInicio && elemento.tagName === "BUTTON"){

            let tempo = Date.now() - tempoInicio;

            progress.style.width = (tempo / 20) + "px";

            if(tempo > 5000){ // 5 segundos
                elemento.click();
                tempoInicio = null;
                progress.style.width="0px";
            }
        }
    }
});

/* ===== INICIAR WEBCAM ===== */

function iniciarCamera(){

    camera = new Camera(video, {
        onFrame: async () => {
            await faceMesh.send({image: video});
        },
        width: 640,
        height: 480
    });

    camera.start();
}

</script>

</body>
</html>
