<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Head Mouse com √Årea de Trabalho</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
body{
    margin:0;
    background:#111827;
    overflow:hidden;
    font-family:Arial;
    color:white;
}

h2{
    text-align:center;
    margin-top:20px;
}

#cursor{
    width:25px;
    height:25px;
    background:#ff0000;
    border-radius:50%;
    position:absolute;
    pointer-events:none;
    z-index:9999;
}

#progress{
    height:6px;
    width:0;
    background:yellow;
    position:absolute;
    pointer-events:none;
    z-index:9999;
}

video{
    position:fixed;
    bottom:10px;
    right:10px;
    width:220px;
    border-radius:10px;
    border:2px solid white;
}

button{
    padding:20px;
    font-size:18px;
    margin:20px;
    cursor:pointer;
}

#workspace{
    display:none;
    text-align:center;
    margin-top:100px;
}

#home{
    text-align:center;
}
</style>
</head>
<body>

<h2>FACE TRACK</h2>

<div id="home">
    <button onclick="iniciarCamera()">Iniciar Webcam</button>
    <br>
    <button onclick="abrirWorkspace()">Abrir √Årea de Trabalho</button>
</div>

<div id="workspace">
    <h2>√Årea de Trabalho</h2>
    <p>Sistema ativo para cadastro ou opera√ß√µes internas</p>
    <button onclick="voltarHome()">Voltar para Tela Inicial</button>
</div>

<div id="cursor"></div>
<div id="progress"></div>

<video id="video" autoplay playsinline></video>

<script>

const video = document.getElementById('video');
const cursor = document.getElementById('cursor');
const progress = document.getElementById('progress');

let ultimoElemento = null;
let tempoInicio = null;
let camera = null;

/* ===== TROCA DE TELAS ===== */

function abrirWorkspace(){
    document.getElementById("home").style.display="none";
    document.getElementById("workspace").style.display="block";
}

function voltarHome(){
    document.getElementById("workspace").style.display="none";
    document.getElementById("home").style.display="block";
}

/* ===== MEDIAPIPE ===== */

const faceMesh = new FaceMesh({
    locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
    }
});

faceMesh.setOptions({
    maxNumFaces: 1,
    refineLandmarks: true,
    minDetectionConfidence: 0.6,
    minTrackingConfidence: 0.6
});

faceMesh.onResults(results => {

    if(results.multiFaceLandmarks.length > 0){

        const face = results.multiFaceLandmarks[0];

        const nose = face[1];

        const x = nose.x * window.innerWidth;
        const y = nose.y * window.innerHeight;

        cursor.style.left = x + "px";
        cursor.style.top = y + "px";

        progress.style.left = x + "px";
        progress.style.top = (y + 30) + "px";

        const elemento = document.elementFromPoint(x, y);

        if(elemento !== ultimoElemento){
            ultimoElemento = elemento;
            tempoInicio = Date.now();
            progress.style.width = "0px";
        }

        if(elemento && tempoInicio && elemento.tagName === "BUTTON"){

            let tempo = Date.now() - tempoInicio;

            // barra proporcional aos 5 segundos
            progress.style.width = (tempo / 20) + "px";

            if(tempo > 5000){   // üî• AGORA 5 SEGUNDOS
                elemento.click();
                tempoInicio = null;
                progress.style.width="0px";
            }
        }
    }
});

/* ===== INICIAR WEBCAM ===== */

function iniciarCamera(){

    camera = new Camera(video, {
        onFrame: async () => {
            await faceMesh.send({image: video});
        },
        width: 640,
        height: 480
    });

    camera.start();
}

</script>

</body>
</html>
